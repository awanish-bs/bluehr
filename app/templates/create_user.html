{% extends "base.html" %}

{% block content %}
  <h2>Create User</h2>
  <form method="post" novalidate id="createUserForm">
    <div class="form-group">
      <label for="first_name">First Name <span class="text-danger">*</span></label>
      <input type="text" class="form-control" id="first_name" name="first_name" value="{{ form_data.first_name if form_data else '' }}" required>
      <div class="invalid-feedback">First Name is required.</div>
    </div>
    <div class="form-group">
      <label for="last_name">Last Name <span class="text-danger">*</span></label>
      <input type="text" class="form-control" id="last_name" name="last_name" value="{{ form_data.last_name if form_data else '' }}" required>
      <div class="invalid-feedback">Last Name is required.</div>
    </div>
    <div class="form-group">
      <label for="employee_id">Employee ID <span class="text-danger">*</span></label>
      <input type="text" class="form-control" id="employee_id" name="employee_id" value="{{ form_data.employee_id if form_data else '' }}" required>
      <div class="invalid-feedback">Employee ID is required and must be numeric.</div>
    </div>
    <div class="form-group">
      <label for="email">Email <span class="text-danger">*</span></label>
      <input type="email" class="form-control" id="email" name="email" value="{{ form_data.email if form_data else '' }}" required>
      <div class="invalid-feedback">Please enter a valid email address.</div>
    </div>
    <div class="form-group">
      <label for="phone_number">Phone Number</label>
      <input type="tel" class="form-control" id="phone_number" name="phone_number" value="{{ form_data.phone_number if form_data else '' }}">
      <div class="invalid-feedback">Phone number must be exactly 10 digits.</div>
    </div>
    <div class="form-group">
      <label for="aadhar_number">Aadhar Number</label>
      <input type="text" class="form-control" id="aadhar_number" name="aadhar_number" value="{{ form_data.aadhar_number if form_data else '' }}">
      <div class="invalid-feedback">Aadhar must be exactly 12 digits.</div>
    </div>
    <div class="form-group">
      <label for="pan_number">PAN Number</label>
      <input type="text" class="form-control" id="pan_number" name="pan_number" value="{{ form_data.pan_number if form_data else '' }}">
      <div class="invalid-feedback">PAN must be alphanumeric and 10 characters long.</div>
    </div>
    <div class="form-group">
      <label for="bank_account_number">Bank Account Number</label>
      <input type="text" class="form-control" id="bank_account_number" name="bank_account_number" value="{{ form_data.bank_account_number if form_data else '' }}">
      <div class="invalid-feedback">Bank account number must be numeric.</div>
    </div>
    <div class="form-group">
      <label for="password">Password <span class="text-danger">*</span></label>
      <input type="password" class="form-control" id="password" name="password" value="{{ form_data.password if form_data else '' }}" required>
      <div class="invalid-feedback">Password is required.</div>
    </div>
    <div class="form-check">
      <input type="checkbox" class="form-check-input" id="is_admin" name="is_admin" {{ 'checked' if form_data and form_data.is_admin else '' }}>
      <label class="form-check-label" for="is_admin">Is Admin</label>
    </div>
    <button type="submit" class="btn btn-primary mt-3">Create User</button>
  </form>
  <p class="mt-3">
    Already have an account? <a href="{{ url_for('index') }}">Login here</a>
  </p>

  <script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('createUserForm');
    
    // Validation rules
    const validations = {
      first_name: { required: true, message: 'First Name is required.' },
      last_name: { required: true, message: 'Last Name is required.' },
      employee_id: { required: true, pattern: /^[0-9]+$/, message: 'Employee ID is required and must be numeric.' },
      email: { required: true, pattern: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/, message: 'Please enter a valid email address.' },
      phone_number: { required: false, pattern: /^[0-9]{10}$/, message: 'Phone number must be exactly 10 digits.' },
      aadhar_number: { required: false, pattern: /^[0-9]{12}$/, message: 'Aadhar must be exactly 12 digits.' },
      pan_number: { required: false, pattern: /^[A-Za-z0-9]{10}$/, message: 'PAN must be alphanumeric and 10 characters long.' },
      bank_account_number: { required: false, pattern: /^[0-9]+$/, message: 'Bank account number must be numeric.' },
      password: { required: true, message: 'Password is required.' }
    };

    function validateField(field) {
      const value = field.value.trim();
      const rules = validations[field.name];
      if (!rules) return true;

      const feedback = field.nextElementSibling;
      
      // Check required
      if (rules.required && !value) {
        field.classList.add('is-invalid');
        field.classList.remove('is-valid');
        if (feedback) feedback.textContent = rules.message;
        return false;
      }
      
      // Check pattern (only if value is not empty)
      if (value && rules.pattern && !rules.pattern.test(value)) {
        field.classList.add('is-invalid');
        field.classList.remove('is-valid');
        if (feedback) feedback.textContent = rules.message;
        return false;
      }
      
      field.classList.remove('is-invalid');
      if (value) field.classList.add('is-valid');
      return true;
    }

    // Validate on blur
    Object.keys(validations).forEach(function(fieldName) {
      const field = document.getElementById(fieldName);
      if (field) {
        field.addEventListener('blur', function() {
          validateField(this);
        });
        field.addEventListener('input', function() {
          if (this.classList.contains('is-invalid')) {
            validateField(this);
          }
        });
      }
    });

    // Validate on submit
    form.addEventListener('submit', function(e) {
      let isValid = true;
      Object.keys(validations).forEach(function(fieldName) {
        const field = document.getElementById(fieldName);
        if (field && !validateField(field)) {
          isValid = false;
        }
      });
      
      if (!isValid) {
        e.preventDefault();
        e.stopPropagation();
      }
    });
  });
  </script>
{% endblock %}
